<Window x:Class="Plmeco.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="PLMECO Transporte"
        Width="1200" Height="700">

    <DockPanel>
        <!-- Barra superior de botones -->
        <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="5">
            <Button Content="Nueva pestaña desde Excel…" Margin="2"
                    Click="NewTabFromExcel_Click"/>
            <Button Content="Importar en pestaña actual…" Margin="2"
                    Click="ImportIntoCurrentTab_Click"/>
            <Button Content="Guardar (pestaña)" Margin="2"
                    Click="SaveTab_Click"/>
            <Button Content="Guardar como… (pestaña)" Margin="2"
                    Click="SaveTabAs_Click"/>
            <Button Content="Cerrar pestaña" Margin="2"
                    Click="CloseTab_Click"/>
        </StackPanel>

        <!-- Control de pestañas dinámicas -->
        <TabControl x:Name="TabControlDocs"
                    ItemsSource="{Binding Documents}"
                    SelectedIndex="{Binding SelectedIndex, Mode=TwoWay}"
                    Margin="5">

            <!-- Encabezado de cada pestaña -->
            <TabControl.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding Title}" FontWeight="Bold" />
                </DataTemplate>
            </TabControl.ItemTemplate>

            <!-- Contenido de cada pestaña -->
            <TabControl.ContentTemplate>
                <DataTemplate>
                    <DataGrid AutoGenerateColumns="False"
                              CanUserAddRows="True"
                              ItemsSource="{Binding Rows}"
                              HeadersVisibility="Column"
                              GridLinesVisibility="All"
                              AlternatingRowBackground="#F5F5F5"
                              SelectionUnit="Cell"
                              FontSize="13"
                              FontWeight="Normal">
                        
                        <!-- ESTADO -->
                        <DataGridTemplateColumn Header="Estado" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ComboBox SelectedItem="{Binding Estado, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                              ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.EstadosDisponibles}"
                                              FontWeight="Bold"
                                              Foreground="Black"
                                              />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- PRECINTO -->
                        <DataGridTextColumn Header="Precinto"
                                            Binding="{Binding Precinto, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="100" />

                        <!-- LLEGADA REAL -->
                        <DataGridTextColumn Header="Llegada Real"
                                            Binding="{Binding LlegadaReal, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="130" />

                        <!-- SALIDA REAL -->
                        <DataGridTextColumn Header="Salida Real"
                                            Binding="{Binding SalidaReal, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="130" />

                        <!-- LEX -->
                        <DataGridTextColumn Header="LEX"
                                            Binding="{Binding LEX, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="100" />

                        <!-- INCIDENCIAS -->
                        <DataGridTextColumn Header="Incidencias"
                                            Binding="{Binding Incidencias, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="200" />

                        <!-- DESTINO -->
                        <DataGridTextColumn Header="Destino"
                                            Binding="{Binding Destino, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="200" />

                        <!-- SALIDA TOPE -->
                        <DataGridTextColumn Header="Salida Tope"
                                            Binding="{Binding SalidaTope, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="130" />
                    </DataGrid>
                </DataTemplate>
            </TabControl.ContentTemplate>
        </TabControl>
    </DockPanel>
</Window>
